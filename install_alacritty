#!/bin/bash

# Funktion zum Überprüfen, ob ein Programm installiert ist
check_installed() {
    if command -v $1 &> /dev/null
    then
        echo "$1 ist bereits installiert."
        return 0
    else
        return 1
    fi
}

# Überprüfen, ob Alacritty installiert ist
if check_installed alacritty; then
    exit 0
fi

echo "Alacritty wird installiert..."

# System aktualisieren und Abhängigkeiten installieren
sudo apt update
sudo apt install -y cmake libfreetype6-dev libfontconfig1-dev libxcb-xfixes0-dev libxkbcommon-dev python3 curl

# Überprüfen, ob Rust installiert ist, wenn nicht, Rust installieren
if ! check_installed cargo; then
    echo "Rust wird installiert..."
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
    source $HOME/.cargo/env
fi

# Alacritty klonen und kompilieren
echo "Alacritty wird aus dem Quellcode kompiliert..."
git clone https://github.com/alacritty/alacritty.git
cd alacritty || exit
cargo build --release

# Alacritty installieren
echo "Alacritty wird installiert..."
sudo cp target/release/alacritty /usr/local/bin
sudo cp extra/alacritty.desktop /usr/share/applications/

# Optional: Alacritty als Standard-Terminal einstellen
echo "Alacritty wird als Standard-Terminal-Emulator festgelegt..."
sudo update-alternatives --install /usr/bin/x-terminal-emulator x-terminal-emulator /usr/local/bin/alacritty 50

cd ..
sudo rm -rf alacritty

echo "Installation abgeschlossen. Alacritty ist jetzt installiert und einsatzbereit."

